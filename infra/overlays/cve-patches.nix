# infra/overlays/cve-patches.nix
# CVE patches for Critical/High vulnerabilities
# Remove patches once upstream catches up
final: prev: {
  # Pyright with patched esbuild 0.25.12 (Go 1.23.7+) to fix Go stdlib CVEs:
  # - CVE-2025-22871 (critical): net/http request smuggling
  # - CVE-2024-24790 (critical): net/netip ParseAddr panic
  # - CVE-2023-24531 (critical): cmd/go module checksum verification
  # - Plus ~130 additional high/medium severity Go stdlib CVEs
  #
  # The upstream pyright 1.1.407 bundles esbuild 0.19.12 (Go 1.20.12) which
  # contains these vulnerabilities. This overlay upgrades esbuild-loader to
  # 4.4.0 which pulls in esbuild 0.25.12 built with Go 1.23.7.
  #
  # Remove once nixpkgs updates pyright to a version with fixed esbuild.
  # Track: https://github.com/microsoft/pyright - watch for esbuild-loader 4.x
  pyright = final.callPackage ./pyright-patched/package.nix { };
}
