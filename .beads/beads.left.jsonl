{"id":"LV-c699","content_hash":"6109fc3f31d9fa81e5ca1aa3273c8ddaa6a222f10ad0a5c62188da9d83c414be","title":"Fix CI failures present on 1 Nov 2025","description":"Multiple CI test failures are preventing the build from passing. These failures are unrelated to recent code changes and appear to be pre-existing issues that need to be resolved.\n\nContext:\n- All failures observed in GitHub Actions runs on 2025-11-01\n- Failures span multiple platforms: Windows, macOS, and Arch Linux\n- The Nix-based tests are passing successfully\n\nImpact:\n- CI pipeline is failing on every push\n- Blocks confident merging of PRs\n- Prevents automated quality checks from completing","acceptance_criteria":"- [ ] All CI jobs pass on main branch\n- [ ] PowerShell linting completes without errors\n- [ ] PowerShell formatting tests pass on all platforms\n- [ ] No test failures in GitHub Actions workflow","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-01T19:48:13.183234077Z","updated_at":"2025-11-01T22:10:49.18271604Z","closed_at":"2025-11-01T22:10:49.182718569Z","source_repo":".","labels":["ci","infrastructure","testing"],"comments":[{"id":5,"issue_id":"LV-c699","author":"mrdavidlaing","text":"Epic completed! All CI failures from Nov 1, 2025 have been resolved.\n\n**Resolution Summary:**\n\nLV-c699.1 (PowerShell linting) - Fixed by 6770dfa\n- Skipped bash linting on Windows (path conflicts)\n- Fixed unbound $USER variable\n- Result: Windows CI fully passing\n\nLV-c699.2 (PowerShell CRLF tests) - Fixed by 57d7de0\n- Installed native Linux PowerShell (powershell-bin)\n- Resolved ShellSpec issue #351\n- Result: All CRLF tests passing\n\nLV-c699.3 (PowerShell whitespace tests) - Fixed by 57d7de0\n- Same fix as LV-c699.2 (shared root cause)\n- Result: All whitespace tests passing\n\n**Final CI Status:**\nâœ… PowerShell Tests (Windows) - PASSING\nâœ… Bash Tests (macOS) - PASSING\nâœ… Bash Tests (Nix) - PASSING\n\nNote: A new Arch Linux container issue emerged ('make' not found) but this is outside the scope of the original Nov 1 failures.","created_at":"2025-11-01T22:10:59Z"}]}
{"id":"LV-c699.1","content_hash":"910e7a0fb69cf014de51389ec71d8610a0c194249f5d6676341144e9e2f9ce3c","title":"Fix PowerShell linting errors (PSScriptAnalyzer)","description":"The PowerShell linting job is failing with 'make lint' Error 1 on Windows runners.\n\nObserved in:\n- Run 18995053910 (commit 907280d)\n- Run 18996459153 (latest)\n\nError:\n```\nmake: *** [Makefile:30: lint] Error 1\n##[error]Process completed with exit code 2.\n```\n\nThis is blocking the entire CI pipeline on Windows. The linting step must pass before tests can run.\n\nInvestigation needed:\n1. Determine which PowerShell file(s) are failing linting\n2. Identify the specific PSScriptAnalyzer rule violations\n3. Fix the violations or update linting rules if appropriate","acceptance_criteria":"- [ ] PowerShell linting completes without errors on Windows runners\n- [ ] 'make lint' exits with code 0\n- [ ] All PSScriptAnalyzer warnings are resolved or suppressed appropriately","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-01T19:48:28.793288646Z","updated_at":"2025-11-01T22:10:31.639183163Z","closed_at":"2025-11-01T22:10:31.639186631Z","source_repo":".","labels":["ci","linting","powershell","windows"],"comments":[{"id":3,"issue_id":"LV-c699.1","author":"mrdavidlaing","text":"Investigation findings from CI run 19002423665:\n\nThe PowerShell linting is running on Windows but the error output in CI logs is garbled/truncated, showing only 'W' characters before the error.\n\nLocal testing shows:\n- Bash linting passes âœ“  \n- PowerShell linting is skipped on Linux (no pwsh available)\n- The lint-powershell.ps1 script uses PSScriptAnalyzer to check all .ps1 files\n\nNext steps to debug:\n1. Run lint-powershell.ps1 locally on a Windows machine or with PowerShell installed\n2. Or add more verbose output to the CI workflow to capture the actual PSScriptAnalyzer errors\n3. Fix the identified linting violations\n\nThe script is looking for Warning and Error severity issues across all .ps1 files in the repository.","created_at":"2025-11-01T20:50:57Z"},{"id":4,"issue_id":"LV-c699.1","author":"mrdavidlaing","text":"Fixed by commit 6770dfa - Resolved Windows CI linting failures!\n\nTwo key fixes:\n1. **Skip bash linting on Windows** - Added uname detection for MINGW/MSYS/CYGWIN to skip bash linting on Windows due to xargs/WSL path conflicts\n2. **Fix unbound $USER variable** - Used fallback: ${USER:-${USERNAME:-}} for cross-platform compatibility\n\nResults from CI run 19003311597:\nâœ… PowerShell linting: PASSING\nâœ… PowerShell Pester tests: PASSING  \nâœ… All Windows CI jobs: PASSING\n\nThis completes all three beads in the epic!","created_at":"2025-11-01T22:10:41Z"}]}
{"id":"LV-c699.2","content_hash":"dc56f1c2f64dc668c3a8c090a537b1331a3dc91c16ac81ac9643311cc5519aa2","title":"Fix PowerShell CRLF line ending format tests","description":"Multiple ShellSpec tests are failing related to CRLF line ending handling for PowerShell files on macOS and Arch Linux.\n\nFailing tests:\n1. `spec/format_line_endings_spec.sh:94` - converts PowerShell files with LF to CRLF\n2. `spec/format_line_endings_spec.sh:113` - maintains CRLF line endings in PowerShell files\n3. `spec/format_line_endings_spec.sh:132` - normalizes mixed line endings in PowerShell files to CRLF\n\nRoot cause:\nThe format-files.sh script is not properly converting or preserving CRLF (Windows-style) line endings for PowerShell files when running on Unix-based systems (macOS, Linux).\n\nImpact:\n- 6 test failures across macOS and Arch Linux runners\n- Exit code 101 on both platforms\n- These tests were confirmed pre-existing (failing since at least Oct 23)\n\nThis is lower priority than the linting errors but still needs to be fixed for CI to pass.","acceptance_criteria":"- [ ] All line ending tests pass on macOS runner\n- [ ] All line ending tests pass on Arch Linux runner\n- [ ] PowerShell files maintain CRLF line endings after formatting\n- [ ] Mixed line endings are properly normalized to CRLF","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-01T19:48:45.547308274Z","updated_at":"2025-11-01T20:49:31.3551836Z","closed_at":"2025-11-01T20:49:31.355186434Z","source_repo":".","labels":["ci","line-endings","linux","macos","powershell","testing"],"comments":[{"id":1,"issue_id":"LV-c699.2","author":"mrdavidlaing","text":"Fixed by commit 57d7de0 - Added native Linux PowerShell (powershell-bin) to Arch and WSL packages.\n\nThis resolved ShellSpec issue #351 which was causing CRLF line ending tests to fail. The native pwsh binary properly handles PowerShell file formatting with CRLF line endings on Unix systems.\n\nVerified in CI run 19002423665:\n- âœ… All Arch Linux tests passing\n- âœ… All macOS tests passing","created_at":"2025-11-01T20:49:44Z"}]}
{"id":"LV-c699.3","content_hash":"f70e178d61f1a20b8299753a501b286fc2cf1745c6060b7bdcf300957a058aff","title":"Fix PowerShell trailing whitespace/newline format tests","description":"ShellSpec tests are failing related to trailing whitespace and newline handling for PowerShell files on macOS and Arch Linux.\n\nFailing tests:\n1. `spec/format_whitespace_spec.sh:63` - adds trailing CRLF to PowerShell file that lacks one\n2. `spec/format_whitespace_spec.sh:82` - reduces multiple blank lines at end to single CRLF for PowerShell\n3. `spec/format_whitespace_spec.sh:135` - removes trailing spaces from PowerShell files while preserving CRLF\n\nRoot cause:\nThe format-files.sh script's trailing whitespace and newline normalization logic is not working correctly for PowerShell files on Unix systems, particularly when it needs to preserve or add CRLF line endings.\n\nImpact:\n- 6 test failures across macOS and Arch Linux runners\n- May be related to the CRLF line ending issues (LV-c699.2)\n- Could potentially be fixed together with line ending issues\n\nNote: This bead may have dependency on LV-c699.2 if the root cause is shared.","acceptance_criteria":"- [ ] Trailing CRLF tests pass on macOS runner\n- [ ] Trailing CRLF tests pass on Arch Linux runner  \n- [ ] Trailing whitespace is removed while preserving CRLF\n- [ ] Multiple blank lines are normalized to single CRLF","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-01T19:48:56.745838674Z","updated_at":"2025-11-01T20:49:36.52704453Z","closed_at":"2025-11-01T20:49:36.527047253Z","source_repo":".","labels":["ci","linux","macos","powershell","testing","whitespace"],"dependencies":[{"issue_id":"LV-c699.3","depends_on_id":"LV-c699.2","type":"blocks","created_at":"2025-11-01T19:48:56.811093384Z","created_by":"mrdavidlaing"}],"comments":[{"id":2,"issue_id":"LV-c699.3","author":"mrdavidlaing","text":"Fixed by commit 57d7de0 - Same fix as LV-c699.2. \n\nAdding native Linux PowerShell resolved the trailing whitespace/newline tests as well. The root cause was indeed shared between the two beads - both were manifestations of ShellSpec issue #351.\n\nVerified in CI run 19002423665:\n- âœ… All trailing whitespace tests passing on Arch Linux\n- âœ… All trailing whitespace tests passing on macOS\n- âœ… CRLF preservation working correctly","created_at":"2025-11-01T20:49:51Z"}]}
{"id":"LV-f76d","content_hash":"7bf64a47270d339e859ee68a28c0c2fc81eb88d1eda6db280eb4416df496e1f5","title":"Fix Arch Linux CI container missing 'make' package","description":"The Arch Linux CI container is failing with 'make: command not found' error.\n\nObserved in CI run 19003311597:\n- Platform: Arch Linux (archlinux:latest container on ubuntu-latest runner)\n- Step: Check formatting and lint\n- Error: /__w/_temp/d10dc99c-fa54-4418-ba05-e8b059bf591f.sh: line 15: make: command not found\n- Exit code: 127\n\nRoot cause:\nThe Arch Linux container doesn't have 'make' installed by default. This became visible after recent CI changes that started using 'make lint' command.\n\nImpact:\n- Blocks all Arch Linux CI tests\n- Prevents linting and testing from running\n- Only platform currently failing in CI\n\nInvestigation needed:\n1. Check .github/workflows CI configuration for Arch Linux container setup\n2. Determine where system dependencies are installed\n3. Add 'make' to the package list for Arch container","acceptance_criteria":"- [ ] Arch Linux CI container has 'make' installed\n- [ ] 'make lint' runs successfully in Arch container\n- [ ] All Arch Linux CI tests pass\n- [ ] No exit code 127 errors","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-01T22:12:56.853043969Z","updated_at":"2025-11-01T22:18:19.850374985Z","closed_at":"2025-11-01T22:18:19.850378187Z","source_repo":".","labels":["archlinux","ci","container","infrastructure"],"comments":[{"id":6,"issue_id":"LV-f76d","author":"mrdavidlaing","text":"Fixed by commit dcb81c8 - Added 'make' to Arch Linux system dependencies!\n\nRoot cause:\nThe 'make' package was only installed in the cache-miss path (Install tools step) via base-devel, but not in the always-run system dependencies step. When the cache was hit, make was never installed.\n\nFix:\nAdded 'make' explicitly to the \"Install system dependencies (Arch Linux)\" step which always runs, ensuring make is available even with cache hits.\n\nResults from CI run 19003411848:\nâœ… Arch Linux linting: PASSING\nâœ… Arch Linux tests: PASSING\nâœ… All CI jobs: PASSING (4/4 platforms)\n\nThis completes ALL CI failures! Both the original epic (LV-c699) and this new issue are now resolved. ðŸŽ‰","created_at":"2025-11-01T22:18:31Z"}]}
